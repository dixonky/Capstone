<h1 class="no-nav-header">Secret Keeper</h1>
<div class="home">
    <form class="no-nav-form" method="post">
        <label for="username">Username: </label>
        <input type="text" name="username" id="username">
        <br><br>
        <label for="password">Password: </label>
        <input type="text" name="password" id="password">
        <br>
        <p>New User? <a href="/createUser" style="text-decoration: none;">Click here.</a></p>
        <div class="center-button">
            <button onclick="validateAccount()" id="button" type="button">Sign In</button>
        </div><br><br>
        <div class="securityToggle">
            <label class="flipSwitch">
                <input type="checkbox" id="flipSwitch">
                <span class="slider round"></span>
            </label>
        </div><br><br>
        <div id="site-secure" style="display: inline;"><p>Site Secure</p></div>
        <div id="site-not-secure" style="display: none;"><p>Site Not Secure</p></div>
    </form>
</div><br><br>
<div class="secret-logo">
    <img src="images/top-secret-white.png" width="350" height="350" alt="Top Secret">
</div>


<script language="JavaScript">
    
    //Function gets the username and password via the DOM
        //passes data to the testAccount function
    function validateAccount() {
        let uName = document.getElementById('username').value;
        let pword = document.getElementById('password').value;
        testAccount(uName, pword);
    };

    //Function uses the switch to change the site from secure to unsecure
    //!!Still very much in development!!
    $('#flipSwitch').click(function() {
        if (sessionStorage.getItem('security') == null) {
            document.getElementById('site-secure').style.display = "none";
            document.getElementById('site-not-secure').style.display = "inline";

            sessionStorage.setItem('security', 'not-secure');
            console.log(sessionStorage.getItem('security'));
        }
        else {
            if (sessionStorage.getItem('security') == 'secure') {
                document.getElementById('site-secure').style.display = "none";
                document.getElementById('site-not-secure').style.display = "inline";
                sessionStorage.setItem('security', 'not-secure');
                console.log(sessionStorage.getItem('security'));
            }
            else if (sessionStorage.getItem('security') == 'not-secure') {
                document.getElementById('site-secure').style.display = "inline";
                document.getElementById('site-not-secure').style.display = "none";
                sessionStorage.setItem('security', 'secure');
                console.log(sessionStorage.getItem('security'));
            }
        }
    });
    
    //Function sends AJAX PUT message to own URL 
        //Count refers to the presence of the username and password combo, 1 = present
        //If the username and password match a user, load the user page with credentials
    function testAccount(user_name,user_pass)
    {
        $.ajax({
            url: '/',
            data: {user_name: user_name, user_pass: user_pass},
            type: 'PUT',
            success: function(result) {
                count = result[0].total;
                if (count == 0) {

                }
                else if (count==1){
                    window.location.href = '/user/'+user_name+'&'+user_pass;
                }
                else {
                }
            }
        })
    }
</script>